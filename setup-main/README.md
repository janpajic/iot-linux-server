# EMBER Setup for Raspberry Pi

This is the Ansible-based automated setup for EMBER on Raspberry Pi. The starting point is a vanilla Ubuntu Server installation (the version`21.04` has been tested). After the installation, the hostname will be set to `ember-linux`, the login user will be `ember`, and its password will be `hardwario`.


## Pre-installation

It is necessary to create user `ember`, set its password and allow it to become the root user. Also, the user `ubuntu` will be disabled. Follow the steps below.

Log in via SSH to Raspberry Pi:

```
ssh ubuntu@---HOST-IP-ADDRESS---
```

You will be prompted for a password change, use these credentials:

```
Current password: ubuntu
New password: hardwario
Retype new password: hardwario
```

Log in via SSH again to Raspberry Pi (with password `hardwario`):

```
ssh ubuntu@---HOST-IP-ADDRESS---
```

Add user `ember` and create its home directory:

```
sudo useradd -d /home/ember -s /bin/bash -m ember
```

Set password `hardwario` for user `ember`:

```
echo 'ember:hardwario' | sudo chpasswd
```

Add user `ember` to group `sudo`:

```
sudo usermod -aG sudo ember
```

Lock account `ubuntu`:

```
sudo passwd -l ubuntu
```

Log out from SSH:

```
logout
```


## Run installation

1. Add your host(s) to the `hosts` file, for example:

   Example:

   ```
   echo 'ember@10.0.0.188' >> hosts
   ```

3. Now you can run the installation sequence:

   ```
   ansible-playbook -i hosts install.yml --ask-pass -K
   ```

   > When asked for the password, use `hardwario`.

4. In `passwords/<client>` you will find passwords generated by Ansible for each host.

   > In the future, there will be OpenVPN client configuration and other stuff. For now, you will only find there the generated password for PostgreSQL users (used by ChirpStack).


## Notes


### SSH tunneling

Connect to MikroTik via Raspberry Pi and SSH:

```
ssh -N -L 8060:172.31.255.1:80 ember@---HOST-IP-ADDRESS---
```

Then MikroTik's web configuration interface is accessible at `http://localhost:8060/`.

### Firewall rules

The rules for `ufw` have been added in order according to this article: https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04
